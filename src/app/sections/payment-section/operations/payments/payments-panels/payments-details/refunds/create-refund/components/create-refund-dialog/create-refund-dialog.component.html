<div
    *transloco="let t; scope: 'payment-details'; read: 'paymentDetails.refunds.createRefund'"
    fxLayout="column"
    [fxLayoutGap]="layoutGap"
>
    <h2 class="mat-title">{{ t('title') }}</h2>
    <form fxLayout="column" [formGroup]="form">
        <mat-form-field class="create-refund-dialog-reason">
            <mat-label>{{ t('reason') }}</mat-label>
            <input matInput type="text" formControlName="reason" aria-label="reason" [errorStateMatcher]="matcher" />
            <!--            need this like awful ng-ifs to work in formfield. Hint only when there's no error. Can be changed to empty strings inside -->
            <mat-hint *ngIf="!reasonLengthError">{{ reasonLength }}</mat-hint>
            <mat-error *ngIf="reasonLengthError">{{ reasonLength }}</mat-error>
        </mat-form-field>
        <div fxLayout="column" [fxLayoutGap]="layoutGap">
            <mat-checkbox [checked]="isPartialRefund" (change)="togglePartialRefund(!isPartialRefund)">{{
                t('partialRefund')
            }}</mat-checkbox>
            <mat-form-field *ngIf="isPartialRefund && amountControl" class="create-refund-dialog-amount">
                <mat-label>{{ t('amount') }}</mat-label>
                <dsh-format-input [formControl]="amountControl" format="amount" required></dsh-format-input>
                <mat-hint *ngIf="balance$ | async as balance; else loadingBalanceHint">
                    {{ t('availableRefund') }}
                    : {{ balance.refundedAmount.amount | toMajor | currency: balance.refundedAmount.currency }}
                    <br />
                    {{ t('balance') }}
                    : {{ balance.accountBalance.amount | toMajor | currency: balance.accountBalance.currency }}
                </mat-hint>
                <ng-template #loadingBalanceHint>
                    {{ t('balanceLoading') }}
                </ng-template>
            </mat-form-field>
        </div>
    </form>
    <div *transloco="let c" fxLayout fxLayoutAlign="space-between">
        <button dsh-button color="warn" (click)="decline()">{{ c('cancel') }}</button>
        <button dsh-button color="accent" [disabled]="form.invalid" (click)="confirm()">
            {{ c('confirm') }}
        </button>
    </div>
</div>
